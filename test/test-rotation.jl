using DataFrames
using Dates
using IceFloeTracker: get_rotation_measurements

@testset "rotation" begin
    @testset "single rows" begin
        masks = Dict(
            0 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            15 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0
                0 1 1 1 1 1 1 0 0 0 1 1 1 1 1 0
                0 0 1 1 1 1 1 0 0 0 0 0 0 0 1 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            30 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 1 1 1 1 0 0 1 1 1 1 0 0 0
                0 0 0 0 0 1 0 0 0 0 0 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            45 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 0 1 1 0 0 0 0 0 0
                0 0 0 0 1 1 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            60 => Bool[
                0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            75 => Bool[
                0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 0 0 1 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            90 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            105 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            120 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 1 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            135 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 0 0 1 0 0 0 0
                0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            150 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 1 1 1 1 0 1 1 1 0 0 0
                0 0 0 0 1 1 1 1 0 0 0 1 0 0 0 0
                0 0 1 1 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            165 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 0
                0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1
                0 1 1 1 1 1 0 0 0 0 1 1 1 1 0 0
                0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            180 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            195 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 1 0 0 0 0 0 0 0 1 1 1 1 1 0 0
                0 1 1 1 1 1 0 0 0 1 1 1 1 1 1 0
                0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            210 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 0 0 0 0 0 1 0 0 0 0 0
                0 0 0 1 1 1 1 0 0 1 1 1 1 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            225 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 1 1 0 0 0 0
                0 0 0 0 0 0 1 1 0 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            240 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0
                0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0],
            255 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 1 0 0 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 0 0 0 0
                0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0
                0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0],
            270 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 1 1 1 1 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            285 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            300 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            315 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0
                0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0
                0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0
                0 0 0 0 1 0 0 1 1 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            330 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0
                0 0 0 0 0 0 0 0 0 0 1 1 1 1 0 0
                0 0 0 0 1 0 0 0 1 1 1 1 0 0 0 0
                0 0 0 1 1 1 0 1 1 1 1 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0
                1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0
                0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            345 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0
                0 0 1 1 1 1 0 0 0 0 1 1 1 1 1 0
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0
                0 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0
                0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
            360 => Bool[
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0],
        )
        @testset "simple case" begin


            df = DataFrame([
                (time=DateTime("2020-01-12T12:00:00"), mask=masks[0]),
                (time=DateTime("2020-01-13T12:00:00"), mask=masks[90])
            ])

            result = get_rotation_measurements(df[1, :], df[2, :];
                mask_column=:mask, time_column=:time)

            @test result["theta_deg"] == 90
            @test result["theta_rad"] ≈ π / 2.0
            @test result["delta_time_sec"] == 86400

            @test result["omega_deg_per_sec"] ≈ 90.0 / 86400.0
            @test result["omega_deg_per_hour"] ≈ 90.0 / 86400.0 * 3600.0
            @test result["omega_deg_per_day"] ≈ 90.0 / 86400.0 * 3600.0 * 24.0

            @test result["omega_rad_per_sec"] ≈ π / 2.0 / 86400.0
            @test result["omega_rad_per_hour"] ≈ π / 2.0 / 86400.0 * 3600.0
            @test result["omega_rad_per_day"] ≈ π / 2.0 / 86400.0 * 3600.0 * 24.0

            @test result["mask1"] == masks[0]
            @test result["mask2"] == masks[90]
        end
        @testset "sampled cases" begin
            function check_single_rotation_measurements(
                time1, Δt_sec::Int64, mask1, mask2, Δθ_deg,
            )
                df = DataFrame([(time=time1, mask=mask1), (time=time1 + Second(Δt_sec), mask=mask2)])

                result = get_rotation_measurements(df[1, :], df[2, :];
                    mask_column=:mask, time_column=:time)
                println(result)

                @test (Δθ_deg - 5.1) <= result["theta_deg"] <= (Δθ_deg + 5.1)
                @test result["theta_rad"] ≈ deg2rad(result["theta_deg"])

                @test result["delta_time_sec"] ≈ Δt_sec

                ω_deg_per_sec = result["theta_deg"] / result["delta_time_sec"]
                @test result["omega_deg_per_sec"] ≈ ω_deg_per_sec
                @test result["omega_deg_per_hour"] ≈ ω_deg_per_sec * 3600.0
                @test result["omega_deg_per_day"] ≈ ω_deg_per_sec * 86400.0

                # We want the values in radians to be the same as those in degrees
                @test result["omega_rad_per_sec"] ≈ deg2rad(result["omega_deg_per_sec"])
                @test result["omega_rad_per_hour"] ≈ deg2rad(result["omega_deg_per_hour"])
                @test result["omega_rad_per_day"] ≈ deg2rad(result["omega_deg_per_day"])

                @test result["mask1"] == mask1
                @test result["mask2"] == mask2

            end

            check_single_rotation_measurements(
                DateTime("2020-01-12T12:00:00"),
                1,
                masks[360],
                masks[0],
                0
            )
            check_single_rotation_measurements(
                DateTime("2020-01-12T12:00:00"),
                3600,
                masks[15],
                masks[0],
                -15
            )
            check_single_rotation_measurements(
                DateTime("2003-01-12T12:00:00"),
                7200,
                masks[0],
                masks[15],
                15
            )
            check_single_rotation_measurements(
                DateTime("2003-01-12T12:00:00"),
                86400,
                masks[0],
                masks[30],
                30
            )
            check_single_rotation_measurements(
                DateTime("2003-01-12T12:00:00"),
                864_000,
                masks[0],
                masks[30],
                30
            )
            check_single_rotation_measurements(
                DateTime("2003-01-12T12:00:00"),
                86_400 + 3600,
                masks[0],
                masks[30],
                30
            )
        end
    end
end
